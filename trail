-- Fixed Mobile Game Explorer
-- Works on all devices, properly displays data

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- Wait for game to fully load
if not game:IsLoaded() then
    game.Loaded:Wait()
end

if not player.Character then
    player.CharacterAdded:Wait()
end

-- Create UI with proper mobile sizing
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MobileGameExplorer"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Make sure it's properly parented
repeat
    task.wait(0.1)
until pcall(function()
    ScreenGui.Parent = game.CoreGui
end)

-- Main container with safe area for mobile
local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(1, 0, 1, 0)
MainContainer.BackgroundTransparency = 1
MainContainer.Parent = ScreenGui

-- Safe area frame (accounts for mobile notches)
local SafeArea = Instance.new("Frame")
SafeArea.Size = UDim2.new(0.95, 0, 0.9, 0)
SafeArea.Position = UDim2.new(0.025, 0, 0.05, 0)
SafeArea.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
SafeArea.BackgroundTransparency = 0.05
SafeArea.Parent = MainContainer

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = SafeArea

-- Title bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 50)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
TitleBar.Parent = SafeArea

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12, 0, 0)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Text = "ðŸ“± Game Data Explorer"
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 20
Title.Parent = TitleBar

-- Scrollable content area
local ContentFrame = Instance.new("ScrollingFrame")
ContentFrame.Size = UDim2.new(1, 0, 1, -110)
ContentFrame.Position = UDim2.new(0, 0, 0, 60)
ContentFrame.BackgroundTransparency = 1
ContentFrame.ScrollBarThickness = 6
ContentFrame.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 150)
ContentFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
ContentFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ContentFrame.Parent = SafeArea

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, 8)
ContentLayout.Parent = ContentFrame

-- Control buttons at bottom
local ButtonFrame = Instance.new("Frame")
ButtonFrame.Size = UDim2.new(1, 0, 0, 50)
ButtonFrame.Position = UDim2.new(0, 0, 1, -50)
ButtonFrame.BackgroundTransparency = 1
ButtonFrame.Parent = SafeArea

-- Function to create styled text label
local function createDataLabel(text, color, indent)
    local label = Instance.new("TextLabel")
    label.Text = (indent and "  â€¢ " or "") .. text
    label.Size = UDim2.new(1, -20, 0, 30)
    label.Position = UDim2.new(0, indent and 20 or 10, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = color or Color3.fromRGB(220, 220, 220)
    label.Font = Enum.Font.SourceSans
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextWrapped = true
    label.Parent = ContentFrame
    return label
end

-- Function to create section header
local function createSectionHeader(text)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 40)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 55)
    frame.Parent = ContentFrame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    local label = Instance.new("TextLabel")
    label.Text = "ðŸ“‚ " .. text
    label.Size = UDim2.new(1, -20, 1, 0)
    label.Position = UDim2.new(0, 10, 0, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(200, 200, 255)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 18
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    return frame
end

-- Function to safely explore game data
local function exploreGameData()
    -- Clear previous content
    for _, child in pairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") or child:IsA("TextLabel") then
            child:Destroy()
        end
    end
    
    local collectedData = {}
    
    -- Basic Game Info
    createSectionHeader("Game Information")
    
    local success, gameInfo = pcall(function()
        return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId)
    end)
    
    if success and gameInfo then
        createDataLabel("Game: " .. gameInfo.Name, Color3.fromRGB(100, 200, 255))
        createDataLabel("Creator: " .. gameInfo.Creator.Name, Color3.fromRGB(150, 200, 150))
    end
    
    createDataLabel("Place ID: " .. game.PlaceId, Color3.fromRGB(180, 180, 220))
    createDataLabel("Game ID: " .. game.GameId, Color3.fromRGB(180, 180, 220))
    createDataLabel("Players: " .. #Players:GetPlayers(), Color3.fromRGB(150, 220, 150))
    
    -- Workspace Objects
    createSectionHeader("Workspace Objects")
    
    local objectCount = 0
    local importantObjects = {}
    
    -- Safely count objects
    for _, obj in pairs(workspace:GetChildren()) do
        objectCount += 1
        if objectCount <= 20 then -- Show first 20
            if obj:IsA("Model") or obj:IsA("Part") then
                table.insert(importantObjects, obj.Name .. " (" .. obj.ClassName .. ")")
            end
        end
    end
    
    createDataLabel("Total Objects: " .. objectCount, Color3.fromRGB(220, 180, 100))
    
    -- Show important objects
    for _, objInfo in ipairs(importantObjects) do
        createDataLabel(objInfo, Color3.fromRGB(200, 200, 200), true)
    end
    
    if #importantObjects < objectCount then
        createDataLabel("... and " .. (objectCount - #importantObjects) .. " more objects", Color3.fromRGB(150, 150, 150))
    end
    
    -- Services Info
    createSectionHeader("Game Services")
    
    local serviceTypes = {}
    for _, service in pairs(game:GetChildren()) do
        if service:IsA("BaseScript") or service.ClassName:find("Service") then
            local className = service.ClassName
            serviceTypes[className] = (serviceTypes[className] or 0) + 1
        end
    end
    
    for serviceName, count in pairs(serviceTypes) do
        createDataLabel(serviceName .. ": " .. count, Color3.fromRGB(180, 150, 220))
    end
    
    -- Player GUI
    createSectionHeader("Player Interface")
    
    if player:FindFirstChild("PlayerGui") then
        local guiCount = 0
        for _, gui in pairs(player.PlayerGui:GetChildren()) do
            guiCount += 1
            if guiCount <= 10 then -- Show first 10
                createDataLabel(gui.Name .. " (" .. gui.ClassName .. ")", Color3.fromRGB(150, 220, 220), true)
            end
        end
        createDataLabel("Total UI Elements: " .. guiCount, Color3.fromRGB(100, 200, 200))
    end
    
    -- Map Information
    createSectionHeader("Map Information")
    
    local camera = workspace.CurrentCamera
    if camera then
        createDataLabel("Camera Position: " .. 
            string.format("X:%.1f, Y:%.1f, Z:%.1f", 
                camera.CFrame.Position.X, 
                camera.CFrame.Position.Y, 
                camera.CFrame.Position.Z), 
            Color3.fromRGB(220, 200, 100))
        
        createDataLabel("Screen Size: " .. 
            math.floor(camera.ViewportSize.X) .. "x" .. 
            math.floor(camera.ViewportSize.Y), 
            Color3.fromRGB(200, 200, 100))
    end
    
    -- Character Info
    if player.Character then
        createSectionHeader("Your Character")
        
        local char = player.Character
        local humanoid = char:FindFirstChildOfClass("Humanoid")
        
        if humanoid then
            createDataLabel("Health: " .. math.floor(humanoid.Health) .. "/" .. math.floor(humanoid.MaxHealth), 
                Color3.fromRGB(220, 100, 100))
            createDataLabel("Walk Speed: " .. humanoid.WalkSpeed, Color3.fromRGB(100, 220, 100))
        end
        
        createDataLabel("Position: " .. 
            string.format("X:%.1f, Y:%.1f, Z:%.1f", 
                char.PrimaryPart and char.PrimaryPart.Position.X or 0,
                char.PrimaryPart and char.PrimaryPart.Position.Y or 0,
                char.PrimaryPart and char.PrimaryPart.Position.Z or 0), 
            Color3.fromRGB(100, 200, 220))
    end
    
    -- Remote Events (Communication)
    createSectionHeader("Game Communication")
    
    local remoteCount = 0
    local repStorage = game:GetService("ReplicatedStorage")
    
    pcall(function()
        for _, obj in pairs(repStorage:GetDescendants()) do
            if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
                remoteCount += 1
                if remoteCount <= 5 then -- Show first 5
                    createDataLabel(obj.Name .. " (" .. obj.ClassName .. ")", Color3.fromRGB(220, 150, 150), true)
                end
            end
        end
    end)
    
    createDataLabel("Total Remote Objects: " .. remoteCount, Color3.fromRGB(220, 120, 120))
    
    return collectedData
end

-- Function to copy all data to clipboard
local function copyAllDataToClipboard()
    local dataText = "=== GAME DATA EXPLORER ===\n\n"
    
    -- Collect data from labels
    for _, child in pairs(ContentFrame:GetChildren()) do
        if child:IsA("TextLabel") then
            dataText = dataText .. child.Text .. "\n"
        elseif child:IsA("Frame") then
            -- Get text from frame's label
            for _, subChild in pairs(child:GetChildren()) do
                if subChild:IsA("TextLabel") then
                    dataText = dataText .. "\n" .. subChild.Text .. "\n"
                end
            end
        end
    end
    
    -- Try to copy
    pcall(function()
        setclipboard(dataText)
    end)
    
    return dataText
end

-- Create control buttons
local exploreBtn = Instance.new("TextButton")
exploreBtn.Text = "ðŸ” Explore Game"
exploreBtn.Size = UDim2.new(0.45, 0, 1, 0)
exploreBtn.Position = UDim2.new(0.025, 0, 0, 0)
exploreBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
exploreBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
exploreBtn.Font = Enum.Font.SourceSansBold
exploreBtn.TextSize = 18
exploreBtn.Parent = ButtonFrame

local copyBtn = Instance.new("TextButton")
copyBtn.Text = "ðŸ“‹ Copy Data"
copyBtn.Size = UDim2.new(0.45, 0, 1, 0)
copyBtn.Position = UDim2.new(0.525, 0, 0, 0)
copyBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 120)
copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
copyBtn.Font = Enum.Font.SourceSansBold
copyBtn.TextSize = 18
copyBtn.Parent = ButtonFrame

local closeBtn = Instance.new("TextButton")
closeBtn.Text = "âœ•"
closeBtn.Size = UDim2.new(0.08, 0, 0.08, 0)
closeBtn.Position = UDim2.new(0.92, 0, 0.01, 0)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 16
closeBtn.Parent = SafeArea

-- Style buttons
for _, btn in pairs({exploreBtn, copyBtn, closeBtn}) do
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(255, 255, 255)
    stroke.Thickness = 1.5
    stroke.Transparency = 0.7
    stroke.Parent = btn
    
    -- Add hover effects
    btn.MouseEnter:Connect(function()
        game:GetService("TweenService"):Create(btn, TweenInfo.new(0.2), {
            BackgroundTransparency = 0.2
        }):Play()
    end)
    
    btn.MouseLeave:Connect(function()
        game:GetService("TweenService"):Create(btn, TweenInfo.new(0.2), {
            BackgroundTransparency = 0
        }):Play()
    end)
end

-- Button actions
exploreBtn.MouseButton1Click:Connect(function()
    exploreBtn.Text = "Exploring..."
    exploreBtn.BackgroundColor3 = Color3.fromRGB(90, 160, 90)
    
    -- Add a small delay for visual feedback
    task.wait(0.3)
    
    exploreGameData()
    
    exploreBtn.Text = "ðŸ” Explore Game"
    exploreBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
end)

copyBtn.MouseButton1Click:Connect(function()
    copyBtn.Text = "Copied! âœ“"
    copyBtn.BackgroundColor3 = Color3.fromRGB(40, 140, 80)
    
    copyAllDataToClipboard()
    
    task.wait(1.5)
    copyBtn.Text = "ðŸ“‹ Copy Data"
    copyBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 120)
end)

closeBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Auto-explore on start
task.wait(0.5)
exploreGameData()

-- Mobile optimization
if game:GetService("UserInputService").TouchEnabled then
    -- Make buttons bigger for touch
    exploreBtn.TextSize = 20
    copyBtn.TextSize = 20
    closeBtn.TextSize = 18
    closeBtn.Size = UDim2.new(0.1, 0, 0.1, 0)
    
    -- Increase scroll bar thickness
    ContentFrame.ScrollBarThickness = 10
end

print("âœ… Mobile Game Explorer Loaded Successfully!")
print("ðŸŽ® Game: " .. game.Name)
print("ðŸ‘¤ Player: " .. player.Name)
print("ðŸ“± Mobile Optimized: " .. tostring(game:GetService("UserInputService").TouchEnabled))
